From 74446bc6cb37f6912551b43f161131691bfc6a04 Mon Sep 17 00:00:00 2001
From: Daniel Reichelt <hacking@nachtgeist.net>
Date: Fri, 24 Sep 2021 16:40:16 +0200
Subject: [PATCH] initramfs: use correct dataset for rootfs on rollback=1

fixes #12585
---
 contrib/initramfs/scripts/zfs | 1 +
 1 file changed, 1 insertion(+)

diff --git a/contrib/initramfs/scripts/zfs b/contrib/initramfs/scripts/zfs
index 306e6e157e6..35502291e6f 100644
--- a/contrib/initramfs/scripts/zfs
+++ b/contrib/initramfs/scripts/zfs
@@ -630,6 +630,7 @@ setup_snapshot_booting()
 		then
 			# Rollback snapshot
 			rollback_snap "$s" || retval=$((retval + 1))
+			ZFS_BOOTFS="${rootfs}"
 		else
 			# Setup a destination filesystem name.
 			# Ex: Called with 'rpool/ROOT/debian@snap2'
